[gcode_macro A0]
gcode:
  {% if ('D' in params) and (params.D|float > 320) and (params.D|float >= 0) %}
    MANUAL_STEPPER STEPPER=my_stepper ENABLE=0                                                          ; Disables
    {% else %}
    {% if printer['tmc2209 manual_stepper my_stepper'].drv_status == None %}
      MANUAL_STEPPER STEPPER=my_stepper ENABLE=1 SPEED=100 SET_POSITION=330 MOVE=0 STOP_ON_ENDSTOP=1	; Homing with bump
      MANUAL_STEPPER STEPPER=my_stepper SPEED=100 MOVE=20
    {% endif %}
    {% if ('D' in params) and (params.D|float <= 320) and (params.D|float >= 0) %}
      MANUAL_STEPPER STEPPER=my_stepper SPEED=200 MOVE={params.D}                                       ; Moves
    {% endif %}
  {% endif %}